package org.engcia.bayessample

import org.sibac.bayes.model.FactBayes;
import org.sibac.bayes.model.Evidence;
import org.sibac.bayes.model.Hypothesis;
import org.sibac.bayes.listeners.TrackingAgendaListener
import org.sibac.bayes.model.Conclusion
import org.sibac.bayes.model.FrameProduct
import org.sibac.bayes.model.FrameTeam;

rule "Do you know your needs? No"

salience 100
/*lock-on-active true*/
when
	Evidence( description == "Do you know what your business needs?", value == "no" )
then
	System.out.println("rule r1 triggered");
	insert(new Hypothesis(1.0, "Frame: Product-constrained", "yes"));
end

rule "Frame:Product-constrained, what is your TRL?"
salience 80
/*lock-on-active true*/
when
	Hypothesis(description == "Frame: Product-constrained", value == "yes")
	$FrameProduct : FrameProduct(probability==1.0, description == "What is your TRL? [value 1-4]", $value : value )
then
    System.out.println("rule r2 triggered");
    insert(new Conclusion("You current succcess probability based on TRL is " + $FrameProduct.getScore() * 100 + "%. Try identifying what your business needs and try again!"));
end


rule "Do you know your needs? Yes"

salience 100
/*lock-on-active true*/
when
	Evidence( description == "Do you know what your business needs?", value == "yes" )
then
	System.out.println("rule r1 triggered yes");
	insert(new Hypothesis(1.0, "Frame: Team", "yes"));
	insert(new FrameTeam(1.0, "Frame: Team", "yes"));
end


rule "Frame: Team"
salience 80
/*lock-on-active true*/
when
	Hypothesis(description == "Frame: Team", value == "yes")
	$TS : Evidence(probability==1.0, description == "Do you have the technical skills?", $TSvalue : value )
	$AS : Evidence(probability==1.0, description == "Do you have the analytical skills?", $ASvalue : value )
	$MS : Evidence(probability==1.0, description == "Do you have the marketing skills?", $MSvalue : value )
	$Experience : Evidence(probability==1.0, description == "Do you have previous experience as a team?", $EXPvalue : value )
	$Goals : Evidence(probability==1.0, description == "Are your personal goals aligned with the start-up vision?", $GOALvalue : value )
	$Expertise : Evidence(probability==1.0, description == "Do your team or advisors have industry expertise?", $EXPERTISEvalue : value )
    $FrameTeam : FrameTeam()
then
    System.out.println("rule r2 triggered yes");
    System.out.println($TSvalue);
    System.out.println($ASvalue);
    System.out.println($MSvalue);
    System.out.println($EXPvalue);
    System.out.println($GOALvalue);
    System.out.println($EXPERTISEvalue);


    System.out.println($FrameTeam.calculateTeamScore($TSvalue, $ASvalue, $MSvalue, $GOALvalue, $EXPvalue, $EXPERTISEvalue));

    insert(new Conclusion("", $FrameTeam.calculateTeamScore($TSvalue, $ASvalue, $MSvalue, $GOALvalue, $EXPvalue, $EXPERTISEvalue)));
    insert(new Hypothesis(1.0, "Frame: Product", "yes"));
end

rule "Frame: Product, what is your TRL?"
salience 50
when
   Hypothesis(description == "Frame: Product", value == "yes")
   $FrameProduct : FrameProduct(probability==1.0, description == "What is your TRL? [value 1-9]", $value : value )
   $Conclusion : Conclusion(description=="")
then
    System.out.println("rule dummy triggered");
    System.out.println($Conclusion.getCount()+$FrameProduct.getScore());
    insert(new Conclusion("Frame:Product", $Conclusion.getCount() + $FrameProduct.getScore()));
end

rule "Do you have competitors? No"
salience 40
when
	Evidence( description == "Do you have competitors?", value == "no" )
then
	System.out.println("rule competitors triggered no");
	insert(new Hypothesis(1.0, "Frame: Traction", "yes"));
end

rule "Convert TractionEvidence values to probabilities"
salience 40
when
    Evidence(probability == 1.0, description == "From 1 to 10, how good is your LTV?", $LTVvalue : value)
    Evidence(probability == 1.0, description == "From 1 to 10, how good is your engagement rate?", $interest : value)
then
	System.out.println("rule convert probs triggered");
	insert(new Hypothesis(Double.valueOf($LTVvalue) * 0.1, "LTV", "yes"));
	insert(new Hypothesis(Double.valueOf($interest) * 0.1, "Interest", "yes"));

	insert(new Hypothesis(Double.valueOf($LTVvalue) * 0.1, "LTVprob", "yes"));
	insert(new Hypothesis(Double.valueOf($interest) * 0.1, "InterestProb", "yes"));


end

rule "Use hypothesis to calculate P(Traction|LTV)"
@LS1(4.0)
@LN1(2.5)
salience 30
when
    Hypothesis(description == "LTV", value == "yes")
then
	System.out.println("rule LTV traction triggered");
    TrackingAgendaListener.getFactRef(Hypothesis.class, "LTVprob", "yes").update();
end

rule "Use hypothesis to calculate P(Traction|Interest)"
@LS1(9.0)
@LN1(0.11)
salience 30
when
    Hypothesis(description == "Interest", value == "yes")
then
	System.out.println("rule Interest traction triggered");
    TrackingAgendaListener.getFactRef(Hypothesis.class, "InterestProb", "yes").update();
end


rule "Create hypotehsis that holds conditional prob of P(interest)*P(LTV)"
salience 25
when
    $LTV : Hypothesis(description == "LTVprob", value == "yes")
    $interest : Hypothesis(description == "InterestProb", value == "yes")
then
    System.out.println("cond prob");
    insert(new Hypothesis($LTV.getProbability() * $interest.getProbability(), "P(Traction|LTVprob|Interest)", "yes"));
end


rule "Use hypothesis to calculate P(Traction|LTV|Interest)"
@LS1(9)
@LN1(0.67)
@LS2(1.5)
@LN2(0.11)
salience 1
when
    Hypothesis(description == "LTVprob", value == "yes") and
    Hypothesis(description == "InterestProb", value == "yes")
then
    System.out.println("Working?");
    TrackingAgendaListener.getFactRef(Hypothesis.class, "P(Traction|LTV|Interest)", "yes").update();
end



rule "Do you have competitors? Yes"
salience 20
when
	Evidence( description == "Do you have competitors?", value == "yes" )
then
	System.out.println("rule competitors triggered yes");
	insert(new Hypothesis(1.0, "Can you protect your technology?", "yes"));
end

/*TODO*/
rule "Can you protect your technology? Yes"
salience 20
when
	Evidence( description == "Can you protect your technology?", value == "yes" )
	$Conclusion : Conclusion(description=="")
then
	System.out.println("rule protect technology triggered yes");
	insert(new Conclusion("Protect-technology", $Conclusion.getCount() + 0.10));
	insert(new Hypothesis(1.0, "Frame: Traction", "yes"));
end